{"is_source_file": true, "format": "Python", "description": "This file defines classes and functions for managing medical conversations, generating notes using AI with fallbacks, storing notes locally, and assisting with AI-driven follow-up questions in a healthcare application.", "external_files": ["models", "ai"], "external_methods": ["Conversation.objects.create", "Conversation.objects.get", "Message.objects.create", "Message.objects.all", "AIClient.summarize_dialogue", "AIClient.ask_follow_up"], "published": ["ConversationManager", "NoteGenerator", "LocalNoteStorage", "AIConversationHelper", "LocalNoteStorageError"], "classes": [{"name": "ConversationManager", "description": "Manages creation, retrieval, and updating of medical conversations."}, {"name": "NoteGenerator", "description": "Generates disease notes from conversations, using AI or heuristic fallback."}, {"name": "LocalNoteStorage", "description": "Handles saving notes as text files in local or cloud-synced directories."}, {"name": "AIConversationHelper", "description": "Provides AI-powered follow-up question generation for clinical intake, assessing coverage and guiding the conversation."}, {"name": "LocalNoteStorageError", "description": "Exception raised for errors when saving notes locally."}], "methods": [{"name": "Conversation start_conversation(self, patient_id: str, metadata: dict | None = None)", "description": "Starts a new patient conversation with optional metadata.", "scope": "ConversationManager", "scopeKind": "class"}, {"name": "Conversation append_messages(self, conversation_id: uuid.UUID, messages: List[Tuple[str, str]])", "description": "Appends a list of messages to an existing conversation.", "scope": "ConversationManager", "scopeKind": "class"}, {"name": "Conversation get_conversation(self, conversation_id: uuid.UUID)", "description": "Retrieves an existing conversation by ID.", "scope": "ConversationManager", "scopeKind": "class"}, {"name": "Tuple[str,str] generate_note(self, conversation: Conversation, note_title: str = \"\")", "description": "Generates a summarized disease note from a conversation, using AI or heuristic methods.", "scope": "NoteGenerator", "scopeKind": "class"}, {"name": "dict save_text_file(self, filename: str, content: str)", "description": "Saves note content as a .txt file in specified or default local directory.", "scope": "LocalNoteStorage", "scopeKind": "class"}, {"name": "str next_follow_up(self, conversation: Conversation)", "description": "Determines the next question or concludes the conversation, based on current dialogue and coverage.", "scope": "AIConversationHelper", "scopeKind": "class"}, {"name": "dict _init_metadata(self, conversation: Conversation)", "description": "Initializes or updates conversation metadata related to intake domains and progress.", "scope": "AIConversationHelper", "scopeKind": "class"}, {"name": "None _update_coverage(self, meta: dict, next_domain: str | None)", "description": "Updates the metadata with newly asked domains and coverage metrics.", "scope": "AIConversationHelper", "scopeKind": "class"}, {"name": "str|None _determine_next_domain(self, meta: dict, patient_texts: list[str])", "description": "Decides the next clinical domain to ask about, based on recent patient inputs and inferred symptom markers.", "scope": "AIConversationHelper", "scopeKind": "class"}, {"name": "list[dict] _build_dialogue(self, conversation: Conversation)", "description": "Converts stored message objects into a dialogue format for AI processing.", "scope": "AIConversationHelper", "scopeKind": "class"}, {"name": "bool _should_conclude(self, meta: dict, next_domain: str | None)", "description": "Decides whether to produce a summarizing conclusion instead of further questions.", "scope": "AIConversationHelper", "scopeKind": "class"}, {"name": "None __init__(self, ai: AIClient | None = None)", "scope": "NoteGenerator", "scopeKind": "class", "description": "unavailable"}, {"name": "None __init__(self, base_dir: str | None = None)", "scope": "LocalNoteStorage", "scopeKind": "class", "description": "unavailable"}, {"name": "bool _looks_like_question(text: str)", "scope": "NoteGenerator.generate_note", "scopeKind": "member", "description": "unavailable"}, {"name": "bool is_meaningful(text: str)", "scope": "AIConversationHelper._determine_next_domain", "scopeKind": "member", "description": "unavailable"}], "calls": ["Conversation.objects.create", "Conversation.objects.get", "Message.objects.create", "Message.objects.all", "self.ai.summarize_dialogue", "self.ai.ask_follow_up", "os.makedirs", "open(target_path, \"wb\")", "self.ai.ask_follow_up"], "search-terms": ["ConversationManager", "NoteGenerator", "AIConversationHelper", "local storage", "generate_note", "next_follow_up", "clinical intake", "medical conversation", "disease note", "AI-driven follow-up"], "state": 2, "file_id": 20, "knowledge_revision": 155, "git_revision": "641eebf5318f3eaf442a45e4a31dce654537d53b", "revision_history": [{"42": ""}, {"55": "075d7988a9ee9cdb57b7dd73f7960809eb2312ef"}, {"60": "075d7988a9ee9cdb57b7dd73f7960809eb2312ef"}, {"75": "f05fa2ba43f3f70d8aab80d7470b94d1314d1de0"}, {"76": "f05fa2ba43f3f70d8aab80d7470b94d1314d1de0"}, {"80": "f05fa2ba43f3f70d8aab80d7470b94d1314d1de0"}, {"111": "6500936dec2ed4b60f4e119fa86646bee7a7d73b"}, {"125": "6500936dec2ed4b60f4e119fa86646bee7a7d73b"}, {"126": "6500936dec2ed4b60f4e119fa86646bee7a7d73b"}, {"134": "39e634f39ccd5ccf738212dbb6fe07f7de1cf821"}, {"135": "39e634f39ccd5ccf738212dbb6fe07f7de1cf821"}, {"136": "4083a1d714f9fdf764358562bc32567a2429c949"}, {"137": "a086d62b1ec015d7c2949094cf0a9dbf3d8846bb"}, {"140": "a086d62b1ec015d7c2949094cf0a9dbf3d8846bb"}, {"148": "f7692a041c99b96f4b90e04b4cbd14b1fac281e8"}, {"149": "f7692a041c99b96f4b90e04b4cbd14b1fac281e8"}, {"150": "f7692a041c99b96f4b90e04b4cbd14b1fac281e8"}, {"151": "f7692a041c99b96f4b90e04b4cbd14b1fac281e8"}, {"155": "641eebf5318f3eaf442a45e4a31dce654537d53b"}], "ctags": [{"_type": "tag", "name": "AIConversationHelper", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^class AIConversationHelper:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ConversationManager", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^class ConversationManager:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "DOMAIN_PLAN", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    DOMAIN_PLAN = [$/", "language": "Python", "kind": "variable", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "LocalNoteStorage", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^class LocalNoteStorage:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LocalNoteStorageError", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^class LocalNoteStorageError(Exception):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MIN_COVERAGE_FOR_CONCLUSION", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    MIN_COVERAGE_FOR_CONCLUSION = 6$/", "language": "Python", "kind": "variable", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "NoteGenerator", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^class NoteGenerator:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def __init__(self, ai: AIClient | None = None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, ai: AIClient | None = None)", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def __init__(self, ai: AIClient | None = None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, ai: AIClient | None = None)", "scope": "NoteGenerator", "scopeKind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def __init__(self, base_dir: str | None = None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, base_dir: str | None = None)", "scope": "LocalNoteStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_build_dialogue", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def _build_dialogue(self, conversation: Conversation) -> list[dict]:$/", "language": "Python", "typeref": "typename:list[dict]", "kind": "member", "signature": "(self, conversation: Conversation)", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "_determine_next_domain", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def _determine_next_domain(self, meta: dict, patient_texts: list[str]) -> str | None:$/", "language": "Python", "typeref": "typename:str|None", "kind": "member", "signature": "(self, meta: dict, patient_texts: list[str])", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "_init_metadata", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def _init_metadata(self, conversation: Conversation) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, conversation: Conversation)", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "_looks_like_question", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^        def _looks_like_question(text: str) -> bool:$/", "file": true, "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(text: str)", "scope": "NoteGenerator.generate_note", "scopeKind": "member"}, {"_type": "tag", "name": "_should_conclude", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def _should_conclude(self, meta: dict, next_domain: str | None) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "member", "signature": "(self, meta: dict, next_domain: str | None)", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "_update_coverage", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def _update_coverage(self, meta: dict, next_domain: str | None) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, meta: dict, next_domain: str | None)", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "append_messages", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def append_messages(self, conversation_id: uuid.UUID, messages: List[Tuple[str, str]]) -> Co/", "language": "Python", "typeref": "typename:Conversation", "kind": "member", "signature": "(self, conversation_id: uuid.UUID, messages: List[Tuple[str, str]])", "scope": "ConversationManager", "scopeKind": "class"}, {"_type": "tag", "name": "generate_note", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def generate_note(self, conversation: Conversation, note_title: str = \"\") -> Tuple[str, str]/", "language": "Python", "typeref": "typename:Tuple[str,str]", "kind": "member", "signature": "(self, conversation: Conversation, note_title: str = \"\")", "scope": "NoteGenerator", "scopeKind": "class"}, {"_type": "tag", "name": "get_conversation", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def get_conversation(self, conversation_id: uuid.UUID) -> Conversation:$/", "language": "Python", "typeref": "typename:Conversation", "kind": "member", "signature": "(self, conversation_id: uuid.UUID)", "scope": "ConversationManager", "scopeKind": "class"}, {"_type": "tag", "name": "is_meaningful", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^        def is_meaningful(text: str) -> bool:$/", "file": true, "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(text: str)", "scope": "AIConversationHelper._determine_next_domain", "scopeKind": "member"}, {"_type": "tag", "name": "next_follow_up", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def next_follow_up(self, conversation: Conversation) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, conversation: Conversation)", "scope": "AIConversationHelper", "scopeKind": "class"}, {"_type": "tag", "name": "save_text_file", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def save_text_file(self, filename: str, content: str) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, filename: str, content: str)", "scope": "LocalNoteStorage", "scopeKind": "class"}, {"_type": "tag", "name": "start_conversation", "path": "/home/kavia/workspace/code-generation/patient-health-inquiry-and-note-management-2974-2983/chatbot_backend/api/services.py", "pattern": "/^    def start_conversation(self, patient_id: str, metadata: dict | None = None) -> Conversation:$/", "language": "Python", "typeref": "typename:Conversation", "kind": "member", "signature": "(self, patient_id: str, metadata: dict | None = None)", "scope": "ConversationManager", "scopeKind": "class"}], "hash": "941db1f6a8f3e07f594f42874c979978", "format-version": 4, "code-base-name": "chatbot_backend", "filename": "chatbot_backend/api/services.py", "fields": [{"name": "DOMAIN_PLAN = [", "scope": "AIConversationHelper", "scopeKind": "class", "description": "unavailable"}, {"name": "MIN_COVERAGE_FOR_CONCLUSION = 6", "scope": "AIConversationHelper", "scopeKind": "class", "description": "unavailable"}]}